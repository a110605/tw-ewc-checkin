FROM node:8-stretch

# Change working directory
WORKDIR "/app"

# Update packages and install dependency packages for services
RUN apt-get update \
 && apt-get dist-upgrade -y \
 && apt-get clean \
 && echo 'Finished installing dependencies'

# Install npm production packages
COPY package.json /app/
RUN cd /app; npm install --production

COPY . /app

# ENV NODE_ENV production
#ENV NODE_ENV development
# ENV PORT 3000
# ENV DEBUG=express:*
#ENV VCAP_SERVICES "{ \"user-provided\": [ { \"binding_name\": null, \"credentials\": { \"apikey\": \"D4sVybJGps1HPNXByuunueMhW5WOSGwxve0gUvVlPqTX\", \"host\": \"4a31bebc-d6f5-4791-bc7f-ba1e48394a19-bluemix.cloudantnosqldb.appdomain.cloud\", \"iam_apikey_description\": \"Auto generated apikey during resource-key operation for Instance - crn:v1:bluemix:public:cloudantnosqldb:us-south:a/468d9ea6781abbe984572ddcd1fabe9d:057d7470-8144-4987-9b68-56585f3dc1ed::\", \"iam_apikey_name\": \"auto-generated-apikey-61b3331c-34d4-4401-8149-716843a20fe7\", \"iam_role_crn\": \"crn:v1:bluemix:public:iam::::serviceRole:Manager\", \"iam_serviceid_crn\": \"crn:v1:bluemix:public:iam-identity::a/468d9ea6781abbe984572ddcd1fabe9d::serviceid:ServiceId-86be849d-6e90-450d-bcf2-305b07bf51ba\", \"password\": \"85670629eac86b34a87d800838e5901684ee2c72f77459cae6a35fa6415a5e44\", \"port\": 443, \"url\": \"https://4a31bebc-d6f5-4791-bc7f-ba1e48394a19-bluemix:85670629eac86b34a87d800838e5901684ee2c72f77459cae6a35fa6415a5e44@4a31bebc-d6f5-4791-bc7f-ba1e48394a19-bluemix.cloudantnosqldb.appdomain.cloud\", \"username\": \"4a31bebc-d6f5-4791-bc7f-ba1e48394a19-bluemix\" }, \"instance_name\": \"tw-ewc-checkin-cloudant-production\", \"label\": \"user-provided\", \"name\": \"tw-ewc-checkin-cloudant-production\", \"syslog_drain_url\": \"\", \"tags\": [], \"volume_mounts\": [] }, { \"binding_name\": null, \"credentials\": { \"cloudant_apikey\": \"V6xLPNOxK0oSwGyi01nBQ8x0Swx5BrFJgKesseBcXYy0\", \"cloudant_host\": \"e75574e2-724c-46e4-8fcd-c21c636dc347-bluemix.cloudantnosqldb.appdomain.cloud\", \"cloudant_iam_apikey_description\": \"Auto generated apikey during resource-key operation for Instance - crn:v1:bluemix:public:cloudantnosqldb:us-east:a/468d9ea6781abbe984572ddcd1fabe9d:7a58b43b-b324-47be-8fa5-a1c3da15c8bf::\", \"cloudant_iam_apikey_name\": \"auto-generated-apikey-694a0c98-ef86-437e-8c5f-fecc824d3e3b\", \"cloudant_iam_role_crn\": \"crn:v1:bluemix:public:iam::::serviceRole:Manager\", \"cloudant_iam_serviceid_crn\": \"crn:v1:bluemix:public:iam-identity::a/468d9ea6781abbe984572ddcd1fabe9d::serviceid:ServiceId-b7482659-cc7c-4632-881d-b8956f7c9526\", \"cloudant_password\": \"8691c16e4346b1f5794841edb1587fb4c208a8249d5b00bf24de29b57c2c11d1\", \"cloudant_port\": 443, \"cloudant_url\": \"https://e75574e2-724c-46e4-8fcd-c21c636dc347-bluemix:8691c16e4346b1f5794841edb1587fb4c208a8249d5b00bf24de29b57c2c11d1@e75574e2-724c-46e4-8fcd-c21c636dc347-bluemix.cloudantnosqldb.appdomain.cloud\", \"cloudant_username\": \"e75574e2-724c-46e4-8fcd-c21c636dc347-bluemix\", \"gmail_id\": \"tw.ewc.checkin@gmail.com\", \"gmail_pw\": \"Passw0rd:checkin\", \"node_checkin_enable\": \"true\", \"node_checkin_event_e\": \"2019-04-01T00:00:00+08:00\", \"node_checkin_event_idx\": \"0\", \"node_checkin_event_s\": \"2019-02-01T00:00:00+08:00\", \"node_checkin_events\": [ \"2018_yep\", \"2019_family\", \"2019_sports\" ], \"node_env\": \"development\", \"node_https_port\": 443, \"node_log_level\": \"debug\", \"node_port\": 3000, \"sms_url\": \"http://api.twsms.com/json/sms_send.php?username=wwwivx\u0026password=passw0rdtwsms\u0026mobile=\", \"w3id_app_host\": \"tw-ewc-checkin.mybluemix.net\", \"w3id_w3cert\": \"MIIDeTCCAmGgAwIBAgIEBLRINzANBgkqhkiG9w0BAQsFADBtMQswCQYDVQQGEwJVUzELMAkGA1UECBMCTlkxDzANBgNVBAcTBkFybW9uazEMMAoGA1UEChMDSUJNMRcwFQYDVQQLEw5DbG91ZCBJZGVudGl0eTEZMBcGA1UEAxMQdzNpZC5zc28uaWJtLmNvbTAeFw0xODA3MDExNDE2NDVaFw0yMzA2MzAxNDE2NDVaMG0xCzAJBgNVBAYTAlVTMQswCQYDVQQIEwJOWTEPMA0GA1UEBxMGQXJtb25rMQwwCgYDVQQKEwNJQk0xFzAVBgNVBAsTDkNsb3VkIElkZW50aXR5MRkwFwYDVQQDExB3M2lkLnNzby5pYm0uY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAnzis3CUuufw+Ov++/3/TAtY5ifqNqR/Cf6xvK8UbGfYuVIiOlWTYTCV7WAwloAHuiaCioCDHkM1Hr6IXs8HjOALVNClGKQDCzSytXzCuZha00JVPRbtiifxLVocW1guR/Egm08tGLtJok7Osp1uaIXubsZkdpWKNg1ixeDvfixwh66/z5uXAJEnGeqdfAaC6iLTdHpU9eRydUathDJo5vi7uvYn5g+b+L9ETauXtlILUV0CnJUrycKeo2ABX1yvs6LWJV6/ITHBmfLWnvIaMfTHk+uRAOqx85RETpGn/G4XItQvp77lukvY9NlE8xAb4hizxSnaGZmsnkGVvry6DjwIDAQABoyEwHzAdBgNVHQ4EFgQUnFcsTH3H3k72ygEnFXyO+p7nCzowDQYJKoZIhvcNAQELBQADggEBAFfADYvSsctSqUzMWIRIj86nJoUFjtrJOGAMTfgYIORmWQq3CkfnIGGj29hfiqNf/d3pdIh6kpvQQ7bXOM/3jBeupteWKUZOWzt8qeY7qc8RJ5z2IKFhuhKT0UkFMsDlTWJL1OUTcg21AyuGVwAayMZm1GgMenRh/bh2zJhFYQJkwlfmhgAyZFXaHm2449nnFduRE1nmqvuLVIusDD5zSO2r4d3gCWMaJI1PTYbMML1Im2eWeW6XrybRs0bdvBCVP1pkhK5BEaN6Tz5qlWsKj1xugrpoq1Ya2JJP0iZg485XI6U+pvRy455P2jl6O7xK/JdfpzjSYT5C2t+bXXdrGlM=\", \"w3id_xml_cert\": \"MIIEowIBAAKCAQEAqANf3DByNgJRZpYbLscGZz3FzLmkot8FeHHCX97Hd63JtsCxKRY5PWkNV7hfXQIdbDxAZjGNrAPEuj22m8JU7RaBnTYtIUAC9aYaH/QN4fCZhPaI1CJW93skchuZTvP5Lg0mGkuqtfbcxqYX2pW7MWpWWXCAkXXeAbQy7u/Y7t9jA7EyB2QaNzjNzbj1LtA7393mjnAtXTkIIscSoL+91tMCrutEBi3vIB4mdMeYDtmQCJuv+hvPzeFndrz3GMPop+6cP0+8QowE5SV+Cw0uHUvsVCRYajKZTXnyclpxcJrbKBuzsm9N8ka+CDDqfp3843kcUkzfkEbtrJWVyugUdQIDAQABAoIBAGH05bT5Qf2fSFppdhvFykPzThnYutaC9SuOF+fRebabSpoUqrXr0R+u2iqkwmT10LXEQz/R8Gm0IMT9KjSSDvXUQ2mnppRWP+N9Hoo2vslWgAt3ubsE8nOEBnHJCY9wy31ACVEXgMZq0bm4KPw2hFeBSisHXs5wTCnuKCwLBw3tmichnpL0kelO1Ki8Ab3CtKb62TTyrdP1ZKBQw4dVq0efnoIScKB92lwrq9xfNESzdwB1x6xrcBWnT1srmmRxnV5m/Fsuu+heCiEfzBBOvHDVqjTb8XnAU/57hNoJjHLMiYd332acNQssdqucLSpq18OH6F7nTNpCIXcqbQA3gEECgYEA2hVtUuSbslBcp00uwvt/yAUlwO7Cq9UXhCTUHu7cV7D9sLgeTpbgyK9K7S9ksoWl73HzyEpgAoa4MdI/GXg0DIbI2AvyJHe+igLToINolhxyu98Si6MOv1wsRuHIGxDbtmH1qYZI3LuTp73gv85Kq/OHdudtJ57UqiBQgnE4Qp0CgYEAxTlijwrbWN5EDSclezQFfgNuRgaB3x+559yFYlkwJeNMTtt/zIhouIzX8K9X7nKEk5P1Epc7S8bPWEcCZ4kxZMrPsgsDEjQw7cPE5KvRDHnOYdhHh7tLzB9EdKfwGtLepNxvqjbmOFmKunm6kWt29T23tPE1GkXKWtrHbRVYZbkCgYA64fQtoHoFcDtEFMvea4d52yHxcMXxHU0HKeZ4H6gwqSImN+A++e/hX6sMVXKL3RgLian311UK+ZL8KLdOyizLgQzzgG41uHsiylaXjUOM3EuCPF3GhBU0R8/Qp5+e5zNbkCGDTzWXG7JnZRYs06dHvC5ERYIsY28qLCVwwt8c5QKBgQCJefXUxfmeWdjP3lDHL70AWP3ePBz9Xk0lbVdg9dCVKHsBoQnVleSBeFPyBxfhM9xsTr+PRPHlYWEZJO5tI3nVy3W5oulyIAVXR5aQ25+t9Z5CIBPEbm9oiwcZ1hKNcB4YhzwjR391Gh2U3NOLGIDkdDABJf4hITLr4AMRa8ahqQKBgGOt6Q4bO0ZL7MeFPYorR08Lz4LVcBpb/8bFxLpEQJKGpLocL5wTnfdTABALL1ZWVppaXhYhQ+njQVcd0/Nyw/NsLrepbdPphZjlxvf4+Aqel5ie1xiby7z79HbKFNREs4PgZqxfsis9i1/BjlOcdNXmRpuFdOgtzIAB5PTuU/QM\" }, \"instance_name\": \"tw-ewc-config\", \"label\": \"user-provided\", \"name\": \"tw-ewc-config\", \"syslog_drain_url\": \"\", \"tags\": [], \"volume_mounts\": [] } ] }"

EXPOSE 3000
EXPOSE 443

CMD ["npm", "start"]
